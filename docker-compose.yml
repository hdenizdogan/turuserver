services:
  jellyfin:
    image: lscr.io/linuxserver/jellyfin:latest
    container_name: jellyfin
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - /mnt/docker/jellyfin:/config
      - /mnt/media:/mnt/media
      - /mnt/media/torrent:/downloads
    networks:
      - jellyfin_net

  jellyfin-tailscale:
    image: tailscale/tailscale
    container_name: jellyfin-tailscale
    hostname: jellyfin-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - jellyfin_net
    volumes:
      - ./tailscale-data/jellyfin:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=jellyfin-turuserver &&
        tailscale funnel --bg 8096
      "

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - /mnt/docker/prowlarr:/config
      - /mnt/media:/mnt/media
      - /mnt/media/torrent:/downloads
    networks:
      - prowlarr_net

  prowlarr-tailscale:
    image: tailscale/tailscale
    container_name: prowlarr-tailscale
    hostname: prowlarr-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - prowlarr_net
    volumes:
      - ./tailscale-data/prowlarr:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=prowlarr-turuserver &&
        tailscale funnel --bg 9696
      "

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - /mnt/docker/sonarr:/config
      - /mnt/media:/mnt/media
      - /mnt/media/torrent:/downloads
    networks:
      - sonarr_net

  sonarr-tailscale:
    image: tailscale/tailscale
    container_name: sonarr-tailscale
    hostname: sonarr-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - sonarr_net
    volumes:
      - ./tailscale-data/sonarr:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=sonarr-turuserver &&
        tailscale funnel --bg 8989
      "

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - /mnt/docker/radarr:/config
      - /mnt/media:/mnt/media
      - /mnt/media/torrent:/downloads
    networks:
      - radarr_net

  radarr-tailscale:
    image: tailscale/tailscale
    container_name: radarr-tailscale
    hostname: radarr-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - radarr_net
    volumes:
      - ./tailscale-data/radarr:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=radarr-turuserver &&
        tailscale funnel --bg 7878
      "

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - /mnt/docker/bazarr:/config
      - /mnt/media:/mnt/media
      - /mnt/media/torrent:/downloads
    networks:
      - bazarr_net

  bazarr-tailscale:
    image: tailscale/tailscale
    container_name: bazarr-tailscale
    hostname: bazarr-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - bazarr_net
    volumes:
      - ./tailscale-data/bazarr:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=bazarr-turuserver &&
        tailscale funnel --bg 6767
      "

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - WEBUI_PORT=8080
    volumes:
      - /mnt/docker/qbittorrent:/config
      - /mnt/media/torrent:/downloads
    networks:
      - qbittorrent_net

  qbittorrent-tailscale:
    image: tailscale/tailscale
    container_name: qbittorrent-tailscale
    hostname: qbittorrent-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - qbittorrent_net
    volumes:
      - ./tailscale-data/qbittorrent:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=qbittorrent-turuserver &&
        tailscale funnel --bg 8080
      "

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: jellyseerr
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - LOG_LEVEL=debug
    volumes:
      - /mnt/docker/jellyseerr:/app/config
    networks:
      - jellyseerr_net

  jellyseerr-tailscale:
    image: tailscale/tailscale
    container_name: jellyseerr-tailscale
    hostname: jellyseerr-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - jellyseerr_net
    volumes:
      - ./tailscale-data/jellyseerr:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=jellyseerr-turuserver &&
        tailscale funnel --bg 5055
      "

  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /mnt/docker/portainer:/data
    networks:
      - portainer_net

  portainer-tailscale:
    image: tailscale/tailscale
    container_name: portainer-tailscale
    hostname: portainer-turuserver
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - portainer_net
    volumes:
      - ./tailscale-data/portainer:/var/lib/tailscale
    environment:
      - TS_AUTHKEY=${TS_AUTHKEY}
    command: >
      sh -c "
        tailscaled --tun=userspace-networking & sleep 2 &&
        tailscale up --auth-key=${TS_AUTHKEY} --hostname=portainer-turuserver &&
        tailscale funnel --bg 9000
      "

networks:
  jellyfin_net:
  prowlarr_net:
  sonarr_net:
  radarr_net:
  bazarr_net:
  qbittorrent_net:
  jellyseerr_net:
  portainer_net:
