{
	# =================================================
	# GLOBAL OPTIONS
	# =================================================

	# Cloudflare DNS-01 for PUBLIC domain (required for wildcard)
	acme_dns cloudflare {$CLOUDFLARE_API_TOKEN}
}

# =================================================
# GLOBAL SNIPPETS
# =================================================

# Common reverse proxy snippet
(proxy) {
	reverse_proxy {args[0]}
}

# =================================================
# PUBLIC DOMAIN (Cloudflare + Let's Encrypt)
# =================================================

# ---- WILDCARD CERT ANCHOR (forces *.DOMAIN issuance) ----
*.{$DOMAIN} {
	tls {
		dns cloudflare {$CLOUDFLARE_API_TOKEN}
	}
	respond 404
}

# ---- PUBLIC SERVICES ----

adguard.{$DOMAIN} {
	import proxy adguard:80
}

jellyfin.{$DOMAIN} {
	import proxy 172.17.0.1:8096
}

jellystat.{$DOMAIN} {
	import proxy jellystat:3000
}

sonarr.{$DOMAIN} {
	import proxy sonarr:8989
}

radarr.{$DOMAIN} {
	import proxy radarr:7878
}

bazarr.{$DOMAIN} {
	import proxy bazarr:6767
}

lidarr.{$DOMAIN} {
	import proxy lidarr:8686
}

lidatube.{$DOMAIN} {
	import proxy lidatube:5000
}

prowlarr.{$DOMAIN} {
	import proxy prowlarr:9696
}

qbittorrent.{$DOMAIN} {
	import proxy qbittorrent:8090
}

seerr.{$DOMAIN} {
	import proxy seerr:5055
}

unmanic.{$DOMAIN} {
	import proxy unmanic:8888
}

portainer.{$DOMAIN} {
	import proxy portainer:9000
}

dash.{$DOMAIN} {
	import proxy dash:3001
}

stirling.{$DOMAIN} {
	import proxy stirling:8080
}

speedtest.{$DOMAIN} {
	import proxy speedtest:80
}

immich.{$DOMAIN} {
	import proxy immich:2283
}

tururouter.{$DOMAIN} {
	import proxy tururouter.lan:80
}

# =================================================
# TAILSCALE DOMAIN (Manual TLS) — UNCHANGED
# =================================================

# HTTP → HTTPS redirect for Tailscale domain
http://*.{$OLDDOMAIN} {
	redir https://{host}{uri} permanent
}

# Tailscale TLS snippet
(tailscale_tls) {
	tls /certs/{args[0]}/certs/{args[0]}.{$OLDDOMAIN}.crt \
	    /certs/{args[0]}/certs/{args[0]}.{$OLDDOMAIN}.key
}

https://jellyfin.{$OLDDOMAIN} {
	import tailscale_tls jellyfin
	import proxy 172.17.0.1:8096
}

https://jellystat.{$OLDDOMAIN} {
	import tailscale_tls jellystat
	import proxy jellystat:3000
}

https://prowlarr.{$OLDDOMAIN} {
	import tailscale_tls prowlarr
	import proxy prowlarr:9696
}

https://qbittorrent.{$OLDDOMAIN} {
	import tailscale_tls qbittorrent
	import proxy qbittorrent:8090
}

https://radarr.{$OLDDOMAIN} {
	import tailscale_tls radarr
	import proxy radarr:7878
}

https://seerr.{$OLDDOMAIN} {
	import tailscale_tls seerr
	import proxy seerr:5055
}

https://sonarr.{$OLDDOMAIN} {
	import tailscale_tls sonarr
	import proxy sonarr:8989
}

https://dash.{$OLDDOMAIN} {
	import tailscale_tls dash
	import proxy dash:3001
}

https://immich.{$OLDDOMAIN} {
	import tailscale_tls immich
	import proxy immich:2283
}